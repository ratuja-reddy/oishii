<!doctype html>
<html lang="en">
<head>
  {% load static %}
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Oishii</title>

  <!-- Tailwind build -->
  <link rel="stylesheet" href="{% static 'css/app.css' %}">
  
  <!-- Custom color overrides -->
  <style>
    /* Primary colors - Terracotta */
    .btn-primary {
      background-color: #CA6145 !important;
      border-color: #CA6145 !important;
    }
    .btn-primary:hover {
      background-color: #B8553A !important;
      border-color: #B8553A !important;
    }
    
    /* Secondary buttons - Dark Teal */
    .btn-secondary {
      background-color: #2F4F4F !important;
      border-color: #2F4F4F !important;
      color: #FFFFFF !important;
    }
    .btn-secondary:hover {
      background-color: #1F3F3F !important;
      border-color: #1F3F3F !important;
    }
    
    /* Text colors */
    .text-primary {
      color: #CA6145 !important;
    }
    .text-secondary {
      color: #2F4F4F !important;
    }
    .text-dark {
      color: #1E1E1E !important;
    }
    .text-dark-teal {
      color: #2F4F4F !important;
    }
    
    /* Background colors */
    .bg-cream {
      background-color: #FAF2EF !important;
    }
    .bg-terracotta {
      background-color: #CA6145 !important;
    }
    .bg-dark-teal {
      background-color: #2F4F4F !important;
    }
    
    /* Override Tailwind defaults - Terracotta */
    .bg-indigo-600 {
      background-color: #CA6145 !important;
    }
    .bg-indigo-700 {
      background-color: #B8553A !important;
    }
    .text-indigo-600 {
      color: #CA6145 !important;
    }
    .text-indigo-700 {
      color: #B8553A !important;
    }
    .border-indigo-600 {
      border-color: #CA6145 !important;
    }
    .ring-indigo-600 {
      --tw-ring-color: #CA6145 !important;
    }
    .focus\:ring-indigo-600:focus {
      --tw-ring-color: #CA6145 !important;
    }
    
    /* Dark teal overrides */
    .bg-blue-600 {
      background-color: #2F4F4F !important;
    }
    .bg-blue-700 {
      background-color: #1F3F3F !important;
    }
    .text-blue-600 {
      color: #2F4F4F !important;
    }
    .text-blue-700 {
      color: #1F3F3F !important;
    }
    .border-blue-600 {
      border-color: #2F4F4F !important;
    }
    .ring-blue-600 {
      --tw-ring-color: #2F4F4F !important;
    }
    .focus\:ring-blue-600:focus {
      --tw-ring-color: #2F4F4F !important;
    }
    
    /* Hover states */
    .hover\:bg-indigo-700:hover {
      background-color: #B8553A !important;
    }
    .hover\:bg-blue-700:hover {
      background-color: #1F3F3F !important;
    }
    .hover\:text-indigo-700:hover {
      color: #B8553A !important;
    }
    .hover\:text-blue-700:hover {
      color: #1F3F3F !important;
    }
    
    /* White text on colored backgrounds */
    .bg-indigo-600 .text-white,
    .bg-indigo-700 .text-white,
    .bg-terracotta .text-white,
    .bg-dark-teal .text-white {
      color: #FFFFFF !important;
    }
  </style>

  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.12" defer></script>

  <!-- Optional: add CSRF header to all HTMX requests (handy for hx-post outside forms) -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
      }
      document.body.addEventListener('htmx:configRequest', function (evt) {
        const csrftoken = getCookie('csrftoken');
        if (csrftoken) {
          evt.detail.headers['X-CSRFToken'] = csrftoken;
        }
      });
      
      // Handle list updates by refreshing the page
      document.body.addEventListener('listUpdated', function (evt) {
        // Close the modal
        document.getElementById('modal').innerHTML = '';
        // Refresh the current page to show updated list names
        window.location.reload();
      });
    });
  </script>
</head>
<body class="min-h-screen bg-cream">

  <!-- Main content -->
  <main class="max-w-xl mx-auto px-4 pt-4 pb-[88px]">
    {% block content %}{% endblock %}
  </main>

  <!-- Bottom nav with floating center button -->
  <nav class="fixed bottom-0 inset-x-0 z-50 bg-cream/90 backdrop-blur border-t border-gray-200 shadow">
    <div class="relative max-w-xl mx-auto flex justify-between items-center text-sm px-8">

      <!-- Left side -->
      <div class="flex-1 flex justify-evenly">
        <a href="{% url 'feed' %}"
           class="flex flex-col items-center py-3 relative {% if active_tab == 'home' %}text-primary font-semibold{% else %}text-dark{% endif %}">
          Home
          <!-- Notification badge for home tab -->
          <span id="home-notification-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center hidden">
            <span id="home-notification-count">0</span>
          </span>
        </a>
        <a href="{% url 'my_restaurants' %}"
           class="flex flex-col items-center py-3 {% if active_tab == 'my' %}text-primary font-semibold{% else %}text-dark{% endif %}">
          My Spots
        </a>
      </div>

      <!-- Floating Review button -->
      <div class="absolute inset-x-0 -top-7 flex justify-center pointer-events-none">
        <a href="{% url 'review_tab' %}"
           class="pointer-events-auto bg-terracotta text-white rounded-full w-12 h-12 flex items-center justify-center shadow-lg ring-4 ring-white text-xl font-bold
                  transition transform {% if active_tab == 'review' %}scale-105{% else %}hover:scale-105{% endif %}">
          +
        </a>
      </div>

      <!-- Right side -->
      <div class="flex-1 flex justify-evenly">
        <a href="{% url 'discover' %}"
           class="flex flex-col items-center py-3 {% if active_tab == 'discover' %}text-primary font-semibold{% else %}text-dark{% endif %}">
          Discover
        </a>
        <a href="{% url 'profile_me' %}"
           class="flex flex-col items-center py-3 {% if active_tab == 'profile' %}text-primary font-semibold{% else %}text-dark{% endif %}">
          My Profile
        </a>
      </div>

    </div>
  </nav>

  <!-- HTMX modal target (needed for “Add to list” popup) -->
  <div id="modal"></div>

</body>
</html>
